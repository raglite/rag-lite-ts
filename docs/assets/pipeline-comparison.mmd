%%{init: {'theme':'base', 'themeVariables': { 'fontSize':'14px'}}}%%

graph TB
    subgraph Header["ðŸ¦Ž RAG-lite TS: Chameleon Architecture - One System, Two Modes"]
        Title[" "]
    end
    
    Title --> Input["ðŸ“¥ Your Content"]
    
    Input --> TextContent["ðŸ“„ Text Files"]
    Input --> ImageContent["ðŸ–¼ï¸ Images + Text"]
    
    subgraph TextFlow["ðŸ“ TEXT MODE PIPELINE"]
        T1["ðŸ“„ Text Documents"]
        T2["ðŸ§¹ Preprocess
        Clean JSX, Mermaid"]
        T3["âœ‚ï¸ Semantic Chunk
        Natural boundaries"]
        T4["ðŸ§  Sentence Transformer
        all-MiniLM-L6-v2"]
        T5["ðŸ“Š 384D Vectors"]
        T6["ðŸ”„ Cross-Encoder Rerank"]
        
        T1 --> T2 --> T3 --> T4 --> T5 --> T6
    end
    
    subgraph MultiFlow["ðŸ–¼ï¸ MULTIMODAL MODE PIPELINE"]
        M1["ðŸ“„ðŸ–¼ï¸ Mixed Content"]
        M2["ðŸ”€ Content Router
        Separate text/images"]
        M3["ðŸ§  CLIP Embedder
        clip-vit-base-patch32"]
        M4["ðŸ“Š 512D Unified Space
        Text â†” Image compatible"]
        M5["ðŸ”„ Text-Derived Rerank"]
        
        M1 --> M2 --> M3 --> M4 --> M5
    end
    
    TextContent --> TextFlow
    ImageContent --> MultiFlow
    
    T6 --> Storage["ðŸ’¾ UNIFIED STORAGE
    ðŸ” HNSW Index
    ðŸ—„ï¸ SQLite Database
    ðŸ“ Content Directory"]
    M5 --> Storage
    
    Storage --> SearchEngine["ðŸ”Ž SEARCH ENGINE
    ðŸ¦Ž Auto-detect mode from DB
    Vector search â€¢ Reranking"]
    
    SearchEngine --> Output["ðŸŽ¯ RESULTS
    âœ¨ Semantic matches
    ðŸ”„ Cross-modal search
    âš¡ Sub-100ms queries"]
    
    Note1["Key Feature:
    Set mode once during ingestion
    Auto-detected during search
    Same API for both modes"]
    
    style Header fill:#fff9c4,stroke:#f57f17,stroke-width:3px
    style Title fill:#fff9c4,stroke:none
    style Input fill:#e3f2fd,stroke:#1976d2,stroke-width:2px
    style TextContent fill:#e8eaf6,stroke:#3f51b5,stroke-width:2px
    style ImageContent fill:#fce4ec,stroke:#c2185b,stroke-width:2px
    style TextFlow fill:#e8eaf6,stroke:#3f51b5,stroke-width:2px
    style MultiFlow fill:#fce4ec,stroke:#c2185b,stroke-width:2px
    style T1,T2,T3,T4,T5,T6 fill:#e8eaf6,stroke:#3f51b5
    style M1,M2,M3,M4,M5 fill:#fce4ec,stroke:#c2185b
    style Storage fill:#e8f5e9,stroke:#388e3c,stroke-width:3px
    style SearchEngine fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    style Output fill:#f3e5f5,stroke:#7b1fa2,stroke-width:3px
    style Note1 fill:#fff9c4,stroke:#f57f17,stroke-width:2px
